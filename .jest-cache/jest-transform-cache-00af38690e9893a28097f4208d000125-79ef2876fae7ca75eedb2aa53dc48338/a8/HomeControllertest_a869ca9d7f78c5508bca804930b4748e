c4629460cdaf4997fb1f9f8ab017f11f
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock the User model and UserService
jest.mock('@models/User');
jest.mock('@services/UserService');
const express_1 = __importDefault(require("express"));
const HomeController_1 = __importDefault(require("@controllers/HomeController"));
describe('HomeController', () => {
    let app;
    let homeController;
    let mockUserService;
    beforeEach(() => {
        app = (0, express_1.default)();
        app.use(express_1.default.json());
        homeController = new HomeController_1.default();
        // Get the mocked UserService instance
        mockUserService = homeController.userService;
        // Clear all mocks
        jest.clearAllMocks();
    });
    describe('getCollectionResponse', () => {
        it('should return collection of users successfully', async () => {
            const mockUsers = [
                { id: 1, name: 'John Doe' },
                { id: 2, name: 'Jane Smith' },
            ];
            mockUserService.getAllUsers = jest.fn().mockResolvedValue(mockUsers);
            const req = {};
            const res = {
                status: jest.fn().mockReturnThis(),
                json: jest.fn(),
            };
            await homeController.getCollectionResponse(req, res);
            expect(mockUserService.getAllUsers).toHaveBeenCalled();
            expect(res.status).toHaveBeenCalledWith(200);
            expect(res.json).toHaveBeenCalledWith({
                data: expect.any(Object),
                error: {},
                success: true,
                message: 'Operation Successful',
            });
        });
        it('should handle database errors gracefully', async () => {
            const error = new Error('Database connection failed');
            mockUserService.getAllUsers = jest.fn().mockRejectedValue(error);
            const req = {};
            const res = {
                status: jest.fn().mockReturnThis(),
                json: jest.fn(),
            };
            await homeController.getCollectionResponse(req, res);
            expect(res.status).toHaveBeenCalledWith(500);
            expect(res.json).toHaveBeenCalledWith({
                data: {},
                error: {
                    message: 'Database connection failed',
                    code: 500,
                },
                success: false,
                message: 'Database connection failed',
            });
        });
    });
    describe('getSingleResponse', () => {
        it('should create and return a new user successfully', async () => {
            const mockUser = { id: 1, name: 'John Doe' };
            mockUserService.createUser = jest.fn().mockResolvedValue(mockUser);
            const req = {
                body: { name: 'John Doe' },
            };
            const res = {
                status: jest.fn().mockReturnThis(),
                json: jest.fn(),
            };
            await homeController.getSingleResponse(req, res);
            expect(mockUserService.createUser).toHaveBeenCalledWith({
                name: 'John Doe',
            });
            expect(res.status).toHaveBeenCalledWith(201);
            expect(res.json).toHaveBeenCalledWith({
                data: expect.any(Object),
                error: {},
                success: true,
                message: 'User created successfully',
            });
        });
        it('should handle validation errors', async () => {
            const error = new Error('Validation failed');
            error.status = 422;
            mockUserService.createUser = jest.fn().mockRejectedValue(error);
            const req = {
                body: { name: '' },
            };
            const res = {
                status: jest.fn().mockReturnThis(),
                json: jest.fn(),
            };
            await homeController.getSingleResponse(req, res);
            expect(res.status).toHaveBeenCalledWith(422);
            expect(res.json).toHaveBeenCalledWith({
                data: {},
                error: {
                    message: 'Validation failed',
                    code: 422,
                },
                success: false,
                message: 'Validation failed',
            });
        });
    });
    describe('getErrorResponse', () => {
        it('should throw sample exception for testing', async () => {
            const req = {};
            const res = {
                status: jest.fn().mockReturnThis(),
                json: jest.fn(),
            };
            await homeController.getErrorResponse(req, res);
            expect(res.status).toHaveBeenCalledWith(400);
            expect(res.json).toHaveBeenCalledWith({
                data: {},
                error: {
                    message: 'Test Exception',
                    code: 422,
                },
                success: false,
                message: 'Test Exception',
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRTpcXEZyZWVsYW5jZXJcXG5vZGVqcy1hcGktd3JhcHBlclxcdGVzdHNcXGNvbnRyb2xsZXJzXFxIb21lQ29udHJvbGxlci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBT0Esc0NBQXNDO0FBQ3RDLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7QUFDMUIsSUFBSSxDQUFDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBUm5DLHNEQUE4QjtBQUM5QixpRkFBeUQ7QUFTekQsUUFBUSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRTtJQUM5QixJQUFJLEdBQXdCLENBQUM7SUFDN0IsSUFBSSxjQUE4QixDQUFDO0lBQ25DLElBQUksZUFBeUMsQ0FBQztJQUU5QyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsR0FBRyxHQUFHLElBQUEsaUJBQU8sR0FBRSxDQUFDO1FBQ2hCLEdBQUcsQ0FBQyxHQUFHLENBQUMsaUJBQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ3hCLGNBQWMsR0FBRyxJQUFJLHdCQUFjLEVBQUUsQ0FBQztRQUV0QyxzQ0FBc0M7UUFDdEMsZUFBZSxHQUFJLGNBQXNCLENBQUMsV0FBVyxDQUFDO1FBRXRELGtCQUFrQjtRQUNsQixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO1FBQ3JDLEVBQUUsQ0FBQyxnREFBZ0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM5RCxNQUFNLFNBQVMsR0FBRztnQkFDaEIsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUU7Z0JBQzNCLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFO2FBQzlCLENBQUM7WUFFRixlQUFlLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUVyRSxNQUFNLEdBQUcsR0FBZ0IsRUFBRSxDQUFDO1lBQzVCLE1BQU0sR0FBRyxHQUFpQjtnQkFDeEIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7Z0JBQ2xDLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO2FBQ2hCLENBQUM7WUFFRixNQUFNLGNBQWMsQ0FBQyxxQkFBcUIsQ0FBQyxHQUFVLEVBQUUsR0FBVSxDQUFDLENBQUM7WUFFbkUsTUFBTSxDQUFDLGVBQWUsQ0FBQyxXQUFXLENBQUMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1lBQ3ZELE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDN0MsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQztnQkFDcEMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDO2dCQUN4QixLQUFLLEVBQUUsRUFBRTtnQkFDVCxPQUFPLEVBQUUsSUFBSTtnQkFDYixPQUFPLEVBQUUsc0JBQXNCO2FBQ2hDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDBDQUEwQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3hELE1BQU0sS0FBSyxHQUFHLElBQUksS0FBSyxDQUFDLDRCQUE0QixDQUFDLENBQUM7WUFDdEQsZUFBZSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFakUsTUFBTSxHQUFHLEdBQWdCLEVBQUUsQ0FBQztZQUM1QixNQUFNLEdBQUcsR0FBaUI7Z0JBQ3hCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsY0FBYyxFQUFFO2dCQUNsQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTthQUNoQixDQUFDO1lBRUYsTUFBTSxjQUFjLENBQUMscUJBQXFCLENBQUMsR0FBVSxFQUFFLEdBQVUsQ0FBQyxDQUFDO1lBRW5FLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDN0MsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQztnQkFDcEMsSUFBSSxFQUFFLEVBQUU7Z0JBQ1IsS0FBSyxFQUFFO29CQUNMLE9BQU8sRUFBRSw0QkFBNEI7b0JBQ3JDLElBQUksRUFBRSxHQUFHO2lCQUNWO2dCQUNELE9BQU8sRUFBRSxLQUFLO2dCQUNkLE9BQU8sRUFBRSw0QkFBNEI7YUFDdEMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7UUFDakMsRUFBRSxDQUFDLGtEQUFrRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2hFLE1BQU0sUUFBUSxHQUFHLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLENBQUM7WUFDN0MsZUFBZSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFbkUsTUFBTSxHQUFHLEdBQWdCO2dCQUN2QixJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFO2FBQzNCLENBQUM7WUFDRixNQUFNLEdBQUcsR0FBaUI7Z0JBQ3hCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsY0FBYyxFQUFFO2dCQUNsQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTthQUNoQixDQUFDO1lBRUYsTUFBTSxjQUFjLENBQUMsaUJBQWlCLENBQUMsR0FBVSxFQUFFLEdBQVUsQ0FBQyxDQUFDO1lBRS9ELE1BQU0sQ0FBQyxlQUFlLENBQUMsVUFBVSxDQUFDLENBQUMsb0JBQW9CLENBQUM7Z0JBQ3RELElBQUksRUFBRSxVQUFVO2FBQ2pCLENBQUMsQ0FBQztZQUNILE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDN0MsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQztnQkFDcEMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDO2dCQUN4QixLQUFLLEVBQUUsRUFBRTtnQkFDVCxPQUFPLEVBQUUsSUFBSTtnQkFDYixPQUFPLEVBQUUsMkJBQTJCO2FBQ3JDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGlDQUFpQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQy9DLE1BQU0sS0FBSyxHQUFHLElBQUksS0FBSyxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFDNUMsS0FBYSxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUM7WUFDNUIsZUFBZSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFaEUsTUFBTSxHQUFHLEdBQWdCO2dCQUN2QixJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFO2FBQ25CLENBQUM7WUFDRixNQUFNLEdBQUcsR0FBaUI7Z0JBQ3hCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsY0FBYyxFQUFFO2dCQUNsQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTthQUNoQixDQUFDO1lBRUYsTUFBTSxjQUFjLENBQUMsaUJBQWlCLENBQUMsR0FBVSxFQUFFLEdBQVUsQ0FBQyxDQUFDO1lBRS9ELE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDN0MsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQztnQkFDcEMsSUFBSSxFQUFFLEVBQUU7Z0JBQ1IsS0FBSyxFQUFFO29CQUNMLE9BQU8sRUFBRSxtQkFBbUI7b0JBQzVCLElBQUksRUFBRSxHQUFHO2lCQUNWO2dCQUNELE9BQU8sRUFBRSxLQUFLO2dCQUNkLE9BQU8sRUFBRSxtQkFBbUI7YUFDN0IsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7UUFDaEMsRUFBRSxDQUFDLDJDQUEyQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3pELE1BQU0sR0FBRyxHQUFnQixFQUFFLENBQUM7WUFDNUIsTUFBTSxHQUFHLEdBQWlCO2dCQUN4QixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGNBQWMsRUFBRTtnQkFDbEMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7YUFDaEIsQ0FBQztZQUVGLE1BQU0sY0FBYyxDQUFDLGdCQUFnQixDQUFDLEdBQVUsRUFBRSxHQUFVLENBQUMsQ0FBQztZQUU5RCxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzdDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsb0JBQW9CLENBQUM7Z0JBQ3BDLElBQUksRUFBRSxFQUFFO2dCQUNSLEtBQUssRUFBRTtvQkFDTCxPQUFPLEVBQUUsZ0JBQWdCO29CQUN6QixJQUFJLEVBQUUsR0FBRztpQkFDVjtnQkFDRCxPQUFPLEVBQUUsS0FBSztnQkFDZCxPQUFPLEVBQUUsZ0JBQWdCO2FBQzFCLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJFOlxcRnJlZWxhbmNlclxcbm9kZWpzLWFwaS13cmFwcGVyXFx0ZXN0c1xcY29udHJvbGxlcnNcXEhvbWVDb250cm9sbGVyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHJlcXVlc3QgZnJvbSAnc3VwZXJ0ZXN0JztcbmltcG9ydCBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IEhvbWVDb250cm9sbGVyIGZyb20gJ0Bjb250cm9sbGVycy9Ib21lQ29udHJvbGxlcic7XG5pbXBvcnQgVXNlciBmcm9tICdAbW9kZWxzL1VzZXInO1xuaW1wb3J0IFVzZXJTZXJ2aWNlIGZyb20gJ0BzZXJ2aWNlcy9Vc2VyU2VydmljZSc7XG5pbXBvcnQgeyBNb2NrUmVxdWVzdCwgTW9ja1Jlc3BvbnNlIH0gZnJvbSAnLi4vLi4vc3JjL3R5cGVzJztcblxuLy8gTW9jayB0aGUgVXNlciBtb2RlbCBhbmQgVXNlclNlcnZpY2Vcbmplc3QubW9jaygnQG1vZGVscy9Vc2VyJyk7XG5qZXN0Lm1vY2soJ0BzZXJ2aWNlcy9Vc2VyU2VydmljZScpO1xuXG5kZXNjcmliZSgnSG9tZUNvbnRyb2xsZXInLCAoKSA9PiB7XG4gIGxldCBhcHA6IGV4cHJlc3MuQXBwbGljYXRpb247XG4gIGxldCBob21lQ29udHJvbGxlcjogSG9tZUNvbnRyb2xsZXI7XG4gIGxldCBtb2NrVXNlclNlcnZpY2U6IGplc3QuTW9ja2VkPFVzZXJTZXJ2aWNlPjtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBhcHAgPSBleHByZXNzKCk7XG4gICAgYXBwLnVzZShleHByZXNzLmpzb24oKSk7XG4gICAgaG9tZUNvbnRyb2xsZXIgPSBuZXcgSG9tZUNvbnRyb2xsZXIoKTtcblxuICAgIC8vIEdldCB0aGUgbW9ja2VkIFVzZXJTZXJ2aWNlIGluc3RhbmNlXG4gICAgbW9ja1VzZXJTZXJ2aWNlID0gKGhvbWVDb250cm9sbGVyIGFzIGFueSkudXNlclNlcnZpY2U7XG5cbiAgICAvLyBDbGVhciBhbGwgbW9ja3NcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldENvbGxlY3Rpb25SZXNwb25zZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBjb2xsZWN0aW9uIG9mIHVzZXJzIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tVc2VycyA9IFtcbiAgICAgICAgeyBpZDogMSwgbmFtZTogJ0pvaG4gRG9lJyB9LFxuICAgICAgICB7IGlkOiAyLCBuYW1lOiAnSmFuZSBTbWl0aCcgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tVc2VyU2VydmljZS5nZXRBbGxVc2VycyA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcnMpO1xuXG4gICAgICBjb25zdCByZXE6IE1vY2tSZXF1ZXN0ID0ge307XG4gICAgICBjb25zdCByZXM6IE1vY2tSZXNwb25zZSA9IHtcbiAgICAgICAgc3RhdHVzOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgICAganNvbjogamVzdC5mbigpLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgaG9tZUNvbnRyb2xsZXIuZ2V0Q29sbGVjdGlvblJlc3BvbnNlKHJlcSBhcyBhbnksIHJlcyBhcyBhbnkpO1xuXG4gICAgICBleHBlY3QobW9ja1VzZXJTZXJ2aWNlLmdldEFsbFVzZXJzKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QocmVzLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoMjAwKTtcbiAgICAgIGV4cGVjdChyZXMuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBkYXRhOiBleHBlY3QuYW55KE9iamVjdCksXG4gICAgICAgIGVycm9yOiB7fSxcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogJ09wZXJhdGlvbiBTdWNjZXNzZnVsJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGF0YWJhc2UgZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnKTtcbiAgICAgIG1vY2tVc2VyU2VydmljZS5nZXRBbGxVc2VycyA9IGplc3QuZm4oKS5tb2NrUmVqZWN0ZWRWYWx1ZShlcnJvcik7XG5cbiAgICAgIGNvbnN0IHJlcTogTW9ja1JlcXVlc3QgPSB7fTtcbiAgICAgIGNvbnN0IHJlczogTW9ja1Jlc3BvbnNlID0ge1xuICAgICAgICBzdGF0dXM6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgICBqc29uOiBqZXN0LmZuKCksXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBob21lQ29udHJvbGxlci5nZXRDb2xsZWN0aW9uUmVzcG9uc2UocmVxIGFzIGFueSwgcmVzIGFzIGFueSk7XG5cbiAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg1MDApO1xuICAgICAgZXhwZWN0KHJlcy5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIGRhdGE6IHt9LFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIG1lc3NhZ2U6ICdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcsXG4gICAgICAgICAgY29kZTogNTAwLFxuICAgICAgICB9LFxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0RhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0U2luZ2xlUmVzcG9uc2UnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgYW5kIHJldHVybiBhIG5ldyB1c2VyIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0geyBpZDogMSwgbmFtZTogJ0pvaG4gRG9lJyB9O1xuICAgICAgbW9ja1VzZXJTZXJ2aWNlLmNyZWF0ZVVzZXIgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuXG4gICAgICBjb25zdCByZXE6IE1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBib2R5OiB7IG5hbWU6ICdKb2huIERvZScgfSxcbiAgICAgIH07XG4gICAgICBjb25zdCByZXM6IE1vY2tSZXNwb25zZSA9IHtcbiAgICAgICAgc3RhdHVzOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgICAganNvbjogamVzdC5mbigpLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgaG9tZUNvbnRyb2xsZXIuZ2V0U2luZ2xlUmVzcG9uc2UocmVxIGFzIGFueSwgcmVzIGFzIGFueSk7XG5cbiAgICAgIGV4cGVjdChtb2NrVXNlclNlcnZpY2UuY3JlYXRlVXNlcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBuYW1lOiAnSm9obiBEb2UnLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoMjAxKTtcbiAgICAgIGV4cGVjdChyZXMuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBkYXRhOiBleHBlY3QuYW55KE9iamVjdCksXG4gICAgICAgIGVycm9yOiB7fSxcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogJ1VzZXIgY3JlYXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB2YWxpZGF0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdWYWxpZGF0aW9uIGZhaWxlZCcpO1xuICAgICAgKGVycm9yIGFzIGFueSkuc3RhdHVzID0gNDIyO1xuICAgICAgbW9ja1VzZXJTZXJ2aWNlLmNyZWF0ZVVzZXIgPSBqZXN0LmZuKCkubW9ja1JlamVjdGVkVmFsdWUoZXJyb3IpO1xuXG4gICAgICBjb25zdCByZXE6IE1vY2tSZXF1ZXN0ID0ge1xuICAgICAgICBib2R5OiB7IG5hbWU6ICcnIH0sXG4gICAgICB9O1xuICAgICAgY29uc3QgcmVzOiBNb2NrUmVzcG9uc2UgPSB7XG4gICAgICAgIHN0YXR1czogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICAgIGpzb246IGplc3QuZm4oKSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGhvbWVDb250cm9sbGVyLmdldFNpbmdsZVJlc3BvbnNlKHJlcSBhcyBhbnksIHJlcyBhcyBhbnkpO1xuXG4gICAgICBleHBlY3QocmVzLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNDIyKTtcbiAgICAgIGV4cGVjdChyZXMuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBkYXRhOiB7fSxcbiAgICAgICAgZXJyb3I6IHtcbiAgICAgICAgICBtZXNzYWdlOiAnVmFsaWRhdGlvbiBmYWlsZWQnLFxuICAgICAgICAgIGNvZGU6IDQyMixcbiAgICAgICAgfSxcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGZhaWxlZCcsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldEVycm9yUmVzcG9uc2UnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBzYW1wbGUgZXhjZXB0aW9uIGZvciB0ZXN0aW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVxOiBNb2NrUmVxdWVzdCA9IHt9O1xuICAgICAgY29uc3QgcmVzOiBNb2NrUmVzcG9uc2UgPSB7XG4gICAgICAgIHN0YXR1czogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICAgIGpzb246IGplc3QuZm4oKSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGhvbWVDb250cm9sbGVyLmdldEVycm9yUmVzcG9uc2UocmVxIGFzIGFueSwgcmVzIGFzIGFueSk7XG5cbiAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg0MDApO1xuICAgICAgZXhwZWN0KHJlcy5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIGRhdGE6IHt9LFxuICAgICAgICBlcnJvcjoge1xuICAgICAgICAgIG1lc3NhZ2U6ICdUZXN0IEV4Y2VwdGlvbicsXG4gICAgICAgICAgY29kZTogNDIyLFxuICAgICAgICB9LFxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ1Rlc3QgRXhjZXB0aW9uJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9